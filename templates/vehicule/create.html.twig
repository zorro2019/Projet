{% extends 'base.html.twig' %}

{% block title 'Gestion vehicule' %}

{% block slider '' %}

{% block body %}
    <div id="all">
        <!-- Top bar-->
        <div class="top-bar">
            <div class="container">
                <div class="row d-flex align-items-center">
                    <div class="col-md-6 d-md-block d-none">
                        <p>Contacts&nbsp;<a class="text-white" href="tel:#">+221778213119</a> ou <a class="text-white" href="mailto:#">contact.fret-Online@gmail.com</a>.</p>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex justify-content-md-end justify-content-between">
                            <ul class="list-inline contact-info d-block d-md-none">
                                <li class="list-inline-item"><a href="tel:#"><i class="fa fa-phone"></i></a></li>
                                <li class="list-inline-item"><a href="mailto:#"><i class="fa fa-envelope"></i></a></li>
                            </ul>
                            <div class="login">
                                {% if app.user == false %}
                                    <a href="{{ path('login') }}" class="login-btn"><i class="fa fa-sign-in"></i><span class="d-none d-md-inline-block">Se connecter</span></a>
                                {% endif %}
                                {% if app.user == false %}
                                    <a href="{{ path('create_compte') }}" class="signup-btn"><i class="fa fa-user"></i><span class="d-none d-md-inline-block">Créer un compte</span></a>
                                {% endif %}
                                {% if app.user  %}
                                    <a href="{{ path('user_espace') }}" class="login-btn">Mon Espace &nbsp;<i class="fa fa-user-o"></i></a>
                                {% endif %}
                                {% if app.user  %}
                                    <a href="{{ path('logout') }}" class="login-btn">Déconnection&nbsp;&nbsp;<i class="fa fa-sign-out"></i></a>
                                {% endif %}
                            </div>
                            <ul class="social-custom list-inline">
                                <li class="list-inline-item"><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li class="list-inline-item"><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                <li class="list-inline-item"><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li class="list-inline-item"><a href="#"><i class="fa fa-envelope"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Top bar end-->
        <!-- Navbar Start-->
        <header class="nav-holder make-sticky">
            <div id="navbar" role="navigation" class="navbar navbar-expand-lg">
                <div class="container"><a href="{{ path('home') }}" class="navbar-brand home">
                        <h2 class="d-none d-md-inline-block"><br>Frêt Online</h2>
                    </a>
                    <button type="button" data-toggle="collapse" data-target="#navigation" class="navbar-toggler btn-template-outlined"><span class="sr-only">Toggle navigation</span><i class="fa fa-align-justify"></i></button>
                    <div id="navigation" class="navbar-collapse collapse">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item nav_link nav_link_active">
                                <a class="nav-link active lnk" href="{{ path('home') }}">Home<span class="sr-only">(current)</span></a>
                            </li>
                            <li class="nav-item nav_link">
                                <a class="nav-link lnk" href="{{ path('fret.direct') }}">Fret en direct</a>
                            </li>
                            <li class="nav-item nav_link">
                                <a class="nav-link lnk" href="{{ path('alert.fret') }}">Alert fret</a>
                            </li>
                            <li class="nav-item nav_link">
                                <a class="nav-link lnk" href="{{ path('faq') }}">Comment ça marche ?</a>
                            </li>
                            <li class="nav-item nav_link">
                                <a class="nav-link lnk" href="{{ path('contact') }}">Contact</a>
                            </li>
                        </ul>
                    </div>
                    <div id="search" class="collapse clearfix">
                        <form role="search" class="navbar-form">
                            <div class="input-group">
                                <input type="text" placeholder="Search" class="form-control"><span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </header>
        <!-- Navbar End-->
        <div id="heading-breadcrumbs">
            <div class="container">
                <div class="row d-flex align-items-center flex-wrap">
                    <div class="col-md-7">
                        <h1 class="font-weight-bold text-primary"><i class="fa fa-angle-right">&nbsp; Espace Vehicule</i></h1>
                    </div>
                    <div class="col-md-5">
                        <ul class="breadcrumb d-flex justify-content-end">
                            <li class="breadcrumb-item"><a href="{{ path('home') }}">Home</a></li>
                            <li class="breadcrumb-item active">Espace Vehicule</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <section class="bar">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <!-- MENUS AND WIDGETS -->
                        <div class="panel panel-default sidebar-menu with-icons">
                            <div class="panel-heading">
                                <h3 class="h4 panel-title">Gestion Vehicule</h3>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-pills flex-column text-sm nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="info-tab" data-toggle="tab" href="#info" role="tab"
                                           aria-controls="info" aria-selected="true"><i
                                                    class="fa fa-truck"></i> Ajouter vehicule</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="post-tab" data-toggle="tab" href="#post" role="tab"
                                           aria-controls="profile" aria-selected="false"><i class="fa fa-list-alt"></i>&nbsp;Voir Vehicule
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="trajet-tab" data-toggle="tab" href="#trajet" role="tab"
                                           aria-controls="trajet" aria-selected="false"><i
                                                    class="fa fa-truck"></i> Trajet endirect</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="transport-tab" data-toggle="tab" href="#transport" role="tab"
                                           aria-controls="transport" aria-selected="false"><i
                                                    class="fa fa-archive"></i> Ajouter Transport</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="detail-tab" data-toggle="tab" href="#detail" role="tab"
                                           aria-controls="detail" aria-selected="false"><i
                                                    class="fa fa-archive"></i>Ajouter Detail Transport</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9 tab-content profile-tab mt-5" id="myTabContent">
                        <div class="tab-pane fade {% if not active['transport'] and not active['detail'] and not active['page'] %} show active {% endif %} mt-2 mb-2 ml-2 mr-2" id="info" role="tabpanel"
                             aria-labelledby="info-tab">
                            <div class="heading">
                                <h5>Nouveau vehicule / Modification</h5>
                            </div>
                            <div class="small">
                                {% for message in app.flashes('success') %}
                                    <p class="alert alert-success text-center">{{ message }}</p>
                                {% endfor %}
                                {{ form_start(form) }}
                                <div class="card-body">
                                    <div class="form-row align-items-end">
                                        <div class="col-md-6 form-group">
                                            <label for="">Matricule</label>
                                            {{ form_errors(form.matricule) }}
                                            <div>{{ form_widget(form.matricule) }}</div>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="">Tonnage</label>
                                            <div>{{ form_errors(form.tonnage) }}</div>
                                            <div>{{ form_widget(form.tonnage) }}</div>
                                        </div>
                                    </div>
                                    <div class="form-row align-items-end">
                                        <div class="col-md-6 form-group">
                                            <label for="">Age</label>
                                            <div>{{ form_errors(form.ageVehicule) }}</div>
                                            <div>{{ form_widget(form.ageVehicule) }}</div>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="">Type Vehicule</label>
                                            <div>{{ form_errors(form.typeVehicule) }}</div>
                                            <div>{{ form_widget(form.typeVehicule) }}</div>
                                        </div>
                                    </div>
                                    <div class="form-row align-items-end">
                                        <div class="col-md-6 form-group">
                                            <label for="">Nom Chauffeur</label>
                                            <div>{{ form_errors(form.nomChauffeur) }}</div>
                                            <div>{{ form_widget(form.nomChauffeur)}}</div>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="">Tel Chauffeur</label>
                                            <div>{{ form_errors(form.telChauffeur) }}</div>
                                            <div>{{ form_widget(form.telChauffeur)}}</div>
                                        </div>
                                    </div>
                                    {% if nombre >= 3 and app.request.get('id') == null %}
                                        <div class="form-row align-items-end">
                                            <div class="col-md-6 form-group">
                                                <label class="text-danger" for="">Type Abonne</label>
                                                <select name="typeAb" id="type" class="form-control" onchange="change();">
                                                    <option value="" selected></option>
                                                    {% for op in toatalAbonnement %}
                                                        <option value="{{ op.montant }}">{{ op.typeAbonnement }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label class="text-danger" for="">Montant</label>
                                                <input disabled type="text" class="form-control" id="idAbonnes" value="">
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class=" ">
                                        {{ form_rest(form) }}
                                        <button type="submit" class="btn btn-primary btn-labeled pull-right">Valider&nbsp;<span class="btn-label btn-label-right"><i class="fa fa-check"></i></span></button>
                                        {% if nombre > 3 and app.request.get('id') == null %}
                                            <p class="small text-danger">Vous avez atteint le nombre de vehicule gratuit.</p>
                                        {% endif %}
                                    </div>
                                </div>
                                {{ form_end(form) }}
                            </div>
                        </div>
                        <div class="tab-pane fade {% if active['page'] %} show active {% endif %} mt-2 mb-2 ml-2 mr-2" id="post" role="tabpanel"
                             aria-labelledby="post-tab">
                            <div class="heading">
                                <h5>Liste de Vehicule</h5>
                            </div>
                            <div>
                                <table class="table table-responsive text-center mt-3">
                                    <tr>
                                        <th>Matricule</th>
                                        <th>Type</th>
                                        <th>Tonnage</th>
                                        <th>Age</th>
                                        <th>Nom Chauffeur</th>
                                        <th>Tel Chauffeur</th>
                                        <th>Editer</th>
                                        <th>Delete</th>
                                    </tr>
                                    {% for vh in listePagine %}
                                        <tr class="link-camion">
                                            <td>{{ vh.matricule }}</td>
                                            <td>
                                                {% if vh.typeVehicule == 1 %}
                                                    Camion
                                                {% endif %}
                                                {% if vh.typeVehicule == 2 %}
                                                    Citerne
                                                {% endif %}
                                                {% if vh.typeVehicule == 3 %}
                                                    Camion Frigorifique
                                                {% endif %}
                                            </td>
                                            <td>{{ vh.tonnage }}</td>
                                            <td>{{ vh.ageVehicule }}</td>
                                            <td>{{ vh.nomChauffeur }}</td>
                                            <td>{{ vh.telChauffeur }}</td>
                                            <td ><a class="text-decoration-none " href="{{ path('edit.vehicule',{id:vh.id}) }}" style="color: orange"><i class="fa fa-pencil"></i></a></td>
                                            <td >
                                                <a class="text-decoration-none " href="{{ path('delete.vehicule',{id:vh.id}) }}" style="color: #a71d2a" onclick=" return confirm('Êtes-vous sûr ?')">
                                                    <input type="hidden" name="_token" value="">
                                                    <i class="fa fa-close"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                                {% if listePagine.getTotalItemCount >5 %}
                                    <div class="text-center">
                                        {{ knp_pagination_render(listePagine) }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="tab-pane fade mt-2 mb-2 ml-2 mr-2" id="trajet" role="tabpanel"
                             aria-labelledby="trajet-tab">
                            <table class="table tabe-streped" id="accordion" role="tablist">
                                <tr>
                                    <th style="background-color: rgba(255,214,43,0.27);">Detail</th>
                                    <th style="background-color: rgba(254,168,255,0.27);">Matricule</th>
                                    <th style="background-color: rgba(126,209,255,0.27);">Type Vehicule</th>
                                    <th style="background-color: rgba(255,202,34,0.27);">Ville</th>
                                    <th style="background-color: rgba(195,255,146,0.27)">Quantite</th>
                                    <th style="background-color: rgba(255,189,242,0.27);">Date</th>
                                </tr>
                                {% for vh in user.listeVehicule %}
                                    {% for vg in vh.voyage  %}
                                        {% if vg.status == 1 %}
                                            {% for dt in vg.listeDetailVoyage %}
                                                {% if dt.position == 1 %}
                                                    <tr class="tab-trajet">
                                                        <td class="text-center" id="headingOne" role="tab" style="background-color:rgba(255,81,46,0.14);width: 2px;">
                                                            <a data-toggle="collapse" href="#td{{ dt.id }}" aria-expanded="true" aria-controls="td{{ dt.id }}">
                                                                <i style="color: green;font-size: 20px;" class="fa fa-plus-circle"></i>
                                                            </a>
                                                        </td>
                                                        <td style="background-color:rgba(156,255,80,0.22);">{{ dt.idVoyage.idVehicule.matricule }}</td>
                                                        <td style="background-color: rgba(80,255,65,0.14);">
                                                            {% if dt.idVoyage.idVehicule.typeVehicule == 1 %}
                                                                Camion
                                                            {% endif %}
                                                            {% if dt.idVoyage.idVehicule.typeVehicule == 2 %}
                                                                Citerne
                                                            {% endif %}
                                                            {% if dt.idVoyage.idVehicule.typeVehicule == 3 %}
                                                                Camion frigorifique
                                                            {% endif %}
                                                        </td>
                                                        <td style="background-color: rgba(156,255,80,0.14);">{{ dt.ville }}</td>
                                                        <td style="background-color: rgba(255,57,254,0.18);">{{ dt.idVoyage.quantiteDetail }}</td>
                                                        <td style="background-color:rgba(156,255,80,0.22);">{{ dt.dateDepart.format('d/m/y') }}</td>
                                                    </tr>
                                                    <tr id="td{{ dt.id }}" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion" class="collapse">
                                                        <td style="background-color: rgba(255,235,244,0.18)" colspan="5">
                                                            <p>
                                                                Cet vehicule a commencé son voyage le {{ dt.idVoyage.debutAt.format('d/m/y') }} en partant de {{ dt.idVoyage.villedepart }} à destination de {{ dt.idVoyage.villearrive }}. Il transporte du {{ dt.idVoyage.produits }}
                                                                Il se trouve actuellement à {{ dt.ville }} avec une charge de {{ dt.idVoyage.quantiteDetail }} tonnes.
                                                            </p>
                                                            <span class="text-bold text-warning pull-left">Information sur le chauffeur : <br>Nom : {{ dt.idVoyage.idVehicule.nomChauffeur }}
                                                                <br>
                                                            Tel : {{ dt.idVoyage.idVehicule.telChauffeur }}
                                                            </span>
                                                            <span class="text-bold text-warning pull-right">Information sur le transporteur : <br>Nom : {{ dt.idVoyage.idVehicule.idAbonne.nom }}
                                                                <br>
                                                                Tel : {{ dt.idVoyage.idVehicule.idAbonne.telephone }}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}

                            </table>
                        </div>
                        <div class="tab-pane fade {% if active['transport'] %} show active{% endif %} mt-2 mb-2 ml-2 mr-2" id="transport" role="tabpanel"
                             aria-labelledby="transport-tab">
                            <div class="heading"><h5>Information transport</h5></div>
                            <div class="small">
                                {{ form_start(formVehicule) }}
                                <div class="card-body">
                                    <h5><i class="fa fa-angle-right">&nbsp;Remarque:</i></h5>
                                    <p class="text-small alert-warning mb-3">Cette partie permet d'enregistrer chaque voyage d'un vehicule.Pour ajouter un détail à un voyage déjà en cours c'est la partie Detail Voyage.</p>
                                    <div class="form-row align-items-end">
                                        <div class="col-md-6 form-group">
                                            <label for="">Matricule Vehicule</label>
                                            <div>
                                                <select name="idVehicule" id="" class="form-control" >
                                                    {% for vh in user.listeVehicule %}
                                                        <option value="{{ vh.id}}">{{ vh.matricule }}</option>
                                                    {% endfor %}
                                                </select></div>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="">Quantié</label>
                                            <div>{{ form_errors(formVehicule.quantite) }}</div>
                                            <div>{{ form_widget(formVehicule.quantite) }}</div>
                                        </div>
                                    </div>
                                    <div class="form-row align-items-end">
                                        <div class="col-md-6 form-group">
                                            <label for="">Ville Depart</label>
                                            <div>{{ form_errors(formVehicule.villedepart) }}</div>
                                            <div>{{ form_widget(formVehicule.villedepart) }}</div>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="">Ville Destination</label>
                                            <div>{{ form_widget(formVehicule.villearrive) }}</div>
                                        </div>
                                    </div>
                                    <div class="form-row align-items-end">
                                        <div class="col-md-4 form-group">
                                            <label for="">Date Départ</label>
                                            <div>{{ form_errors(formVehicule.debutAt) }}</div>
                                            <div>{{ form_widget(formVehicule.debutAt) }}</div>
                                        </div>
                                        <div class="col-md-4 form-group">
                                            <div>{{ form_errors(formVehicule.nouveauVoyage) }}</div>
                                            <div>{{ form_widget(formVehicule.nouveauVoyage) }}</div>
                                        </div>
                                        <div class="col-md-4 form-group">
                                            <label for="">Produits Transporté</label>
                                            <div>{{ form_errors(formVehicule.produits) }}</div>
                                            <div>{{ form_widget(formVehicule.produits) }}</div>
                                        </div>
                                    </div>
                                    {{ form_rest(formVehicule) }}
                                    <button type="submit" name="validerTransport" value="transport" class="btn btn-primary btn-labeled pull-right">Valider&nbsp;<span class="btn-label btn-label-right"><i class="fa fa-check"></i></span></button>
                                    {{ form_end(formVehicule) }}
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade {% if active['detail'] %} show active{% endif %} mt-2 mb-2 ml-2 mr-2" id="detail" role="tabpanel"
                             aria-labelledby="detail-tab">
                            <div class="heading"><h5>Detail transport</h5></div>
                            <div class="small">
                                {{ form_start(formDetail) }}
                                <div class="card-body">
                                    <h5><i class="fa fa-angle-right">&nbsp;Remarque:</i></h5>
                                    <p class="text-small alert-warning mb-3">Cette partie permet d'enregistrer les détails d'un voyage en cours (chargement, dechargement) et eventuellement déterminer la position actuelle du vehicule.</p>
                                    {{ form_rest(formDetail) }}
                                    <div class="form-group">
                                        <label for="">Choisir un vehicule en cours de voyage</label>
                                        <select name="idvoyage" id="" class="form-control">
                                            {% for vh in user.listeVehicule %}
                                                {% for vg in vh.voyage  %}
                                                    {% if vg.status == 1 %}
                                                        <option value="{{ vg.id }}">{{ vg.idVehicule.matricule }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <button type="submit" name="valideDetail" value="detail" class="btn btn-primary btn-labeled pull-right">Valider&nbsp;<span class="btn-label btn-label-right"><i class="fa fa-check"></i></span></button>
                                    {{ form_end(formDetail) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="" type="text/javascript"></script>
    <script>
       function change() {
           var type = document.getElementById('type').value;
           var  prix = document.getElementById('idAbonnes');
           prix.setAttribute('value' , type+' fcfa');
        }
    </script>
{% endblock %}